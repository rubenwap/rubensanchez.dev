<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Upskill yourself by recreating GNU Coreutils in Go - rubensanchez.dev</title>
  <meta name="description" content="Reinventing the wheel for fun One of the most popular advice to gain skills programming is to reimplement tools that already exist. For instance, if you wanted to learn how to do a CRUD API, I am pretty sure you probably practiced with a &ldquo;To do&rdquo; app. The point of this is not to create something new and groundbreaking, but to use well known ideas to improve what you know. Other examples you might have seen are things such as implementing a chat server to learn about websockets, a weather app, a Hacker News reader&hellip;"><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "rubensanchez.dev",
    
    "url": "\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "\/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "\/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "\/blog\/upskill-yourself-by-recreating-gnu-coretools-in-go-9f5\/",
          "name": "Upskill yourself by recreating g n u coreutils in go"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : ""
  },
  "headline": "Upskill yourself by recreating GNU Coreutils in Go",
  "description" : "Reinventing the wheel for fun One of the most popular advice to gain skills programming is to reimplement tools that already exist. For instance, if you wanted to learn how to do a CRUD API, I am pretty sure you probably practiced with a \u0026ldquo;To do\u0026rdquo; app. The point of this is not to create something new and groundbreaking, but to use well known ideas to improve what you know. Other examples you might have seen are things such as implementing a chat server to learn about websockets, a weather app, a Hacker News reader\u0026hellip;",
  "inLanguage" : "en",
  "wordCount":  1451 ,
  "datePublished" : "2020-09-26T21:10:52",
  "dateModified" : "2020-09-26T21:10:52",
  "image" : "\/",
  "keywords" : [ "go, tutorial" ],
  "mainEntityOfPage" : "\/blog\/upskill-yourself-by-recreating-gnu-coretools-in-go-9f5\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "\/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "\/",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="Upskill yourself by recreating GNU Coreutils in Go" />
<meta property="og:description" content="Reinventing the wheel for fun One of the most popular advice to gain skills programming is to reimplement tools that already exist. For instance, if you wanted to learn how to do a CRUD API, I am pretty sure you probably practiced with a &ldquo;To do&rdquo; app. The point of this is not to create something new and groundbreaking, but to use well known ideas to improve what you know. Other examples you might have seen are things such as implementing a chat server to learn about websockets, a weather app, a Hacker News reader&hellip;">
<meta property="og:url" content="/blog/upskill-yourself-by-recreating-gnu-coretools-in-go-9f5/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="rubensanchez.dev" />

  <meta name="twitter:title" content="Upskill yourself by recreating GNU Coreutils in Go" />
  <meta name="twitter:description" content="Reinventing the wheel for fun One of the most popular advice to gain skills programming is to reimplement tools that already exist. For instance, if you wanted to learn how to do a CRUD API, I am â€¦">
  <meta name="twitter:card" content="summary" />
  <meta name="generator" content="Hugo 0.76.5" />
  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="rubensanchez.dev"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" /><link rel="stylesheet" href="/css/syntax.css" /><link rel="stylesheet" href="/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">



  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">rubensanchez.dev</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Contact" href="/contact/">Contact</a>
            </li>
          
        

        

        
      </ul>
    </div>

    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="blog-heading">
              
                <h1>Upskill yourself by recreating GNU Coreutils in Go</h1>
              
              
                <hr class="small">
              
              
              
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <h2 id="reinventing-the-wheel-for-fun">Reinventing the wheel for fun</h2>
<p>One of the most popular advice to gain skills programming is to reimplement tools that already exist. For instance, if you wanted to learn how to do a CRUD API, I am pretty sure you probably practiced with a &ldquo;To do&rdquo; app. The point of this is not to create something new and groundbreaking, but to use well known ideas to improve what you know. Other examples you might have seen are things such as implementing a chat server to learn about websockets, a weather app, a Hacker News reader&hellip;</p>
<p>Today I am talking about something I consider more interesting: Reimplementing the GNU Coreutils utilities. I am not the first person doing this, but I am convinced that you are going to come out of this exercise with way better skills in your language of choice.</p>
<p>So what are the Coreutils? If you use Linux or Mac, you have probably used a bunch of them. Perhaps on Windows too in some cases. <a href="https://www.gnu.org/software/coreutils/coreutils.html">Take a look at this link for more information</a>.</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/i/h2nzpbs2zdpb1dxsqltr.png" alt="GNU"></p>
<p>You can approach this project in different ways. In my case, I know that the point of coreutils is that they are really small and really simple, they do just one task but they do it well. In the original repo in C, most of the tools are just one single file. I am going to start with the same idea.</p>
<ul>
<li>Understand the functionality reading the man page. Requirements.</li>
<li>Implementing that functionality freely with no guidelines other than my own criteria. I do the project plan!</li>
<li>Comparing the output of my tool against the output of the real coreutil tool. This is the QA part.</li>
</ul>
<p>As you see, this is more like a very free exercise rather than a serious structured practice. I am also very flexible in terms of whether or not to use extra libraries. For example, I realized that the
<code>flag</code>
package in Go is a little bit tedious to set up. Other flag packages are much nicer. Also, I need to find one that let concatenate arguments such as
<code>-wl</code>
instead of
<code>-w -l</code>
, <a href="http://www.gnu.org/software/libc/manual/html_node/Argument-Syntax.html">to get as close as possible to the real Coreutils functionality</a>.</p>
<h2 id="wc">WC</h2>
<p>The first tool I picked was the <a href="https://www.gnu.org/software/coreutils/manual/html_node/wc-invocation.html">word counter WC</a>. Not the most difficult, not the easiest. For me, the requirements looked like this:</p>
<ul>
<li>Individual functions for every kind of count</li>
<li>Flag parsing</li>
<li>Main function that would get the input from Stdin and files passed as argument</li>
<li>Depending on the passed flags, the counting functions would run, using the text from the previous step as argument</li>
<li>Results are printed on screen</li>
</ul>
<p>So my rough schema:</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/i/vb6jsf72omi9i90156xm.png" alt="Untitled Diagram"></p>
<p>And here is the code. As mentioned before, the only external dependency is for my own personal taste, but could be easily avoided (specially when I recently <a href="https://dev.to/rubenwap/i-was-doing-bad-stuff-in-my-first-dev-job-sorry-part-ii-iak">spoke about unnecessary dependencies here</a>!) But if we take this as an initial exercise, I think the result is not bad.</p>
<p>I have commented the code so you can follow along</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;bufio&#34;</span>
	<span class="s">&#34;bytes&#34;</span>
	<span class="s">&#34;fmt&#34;</span>
	<span class="s">&#34;github.com/urfave/cli&#34;</span>
	<span class="s">&#34;io/ioutil&#34;</span>
	<span class="s">&#34;log&#34;</span>
	<span class="s">&#34;os&#34;</span>
	<span class="s">&#34;strings&#34;</span>
	<span class="s">&#34;unicode/utf8&#34;</span>
<span class="p">)</span>

<span class="cm">/*
</span><span class="cm">We define the four basic counting functions. 
</span><span class="cm">The interesting thing with Go is that unlike 
</span><span class="cm">languages like Python, len(string) will give you 
</span><span class="cm">the byte count, not the character count. 
</span><span class="cm">For characters, you need to count runes. 
</span><span class="cm">*/</span>

<span class="kd">func</span> <span class="nf">byteCounts</span><span class="p">(</span><span class="nx">text</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">lineCounts</span><span class="p">(</span><span class="nx">text</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="s">&#34;\n&#34;</span><span class="p">))</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">characterCounts</span><span class="p">(</span><span class="nx">text</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">utf8</span><span class="p">.</span><span class="nf">RuneCountInString</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">wordCounts</span><span class="p">(</span><span class="nx">text</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nf">Fields</span><span class="p">(</span><span class="nx">text</span><span class="p">))</span>
<span class="p">}</span>

<span class="cm">/* 
</span><span class="cm">We initialize the CLI App with the definition 
</span><span class="cm">of the flags. I think that the way this library 
</span><span class="cm">handles flags is pretty clean and elegant. 
</span><span class="cm">But feel free to use the `
</span><span class="cm">flag
</span><span class="cm">` package too. 
</span><span class="cm">*/</span>

<span class="kd">func</span> <span class="nf">wc</span><span class="p">()</span> <span class="o">*</span><span class="nx">cli</span><span class="p">.</span><span class="nx">App</span> <span class="p">{</span>
	<span class="nx">app</span> <span class="o">:=</span> <span class="nx">cli</span><span class="p">.</span><span class="nf">NewApp</span><span class="p">()</span>
	<span class="nx">app</span><span class="p">.</span><span class="nx">Name</span> <span class="p">=</span> <span class="s">&#34;WC&#34;</span>
	<span class="nx">app</span><span class="p">.</span><span class="nx">Usage</span> <span class="p">=</span> <span class="s">&#34;The wc utility displays the number of lines, words, and bytes contained in each input file&#34;</span>
	<span class="nx">app</span><span class="p">.</span><span class="nx">Flags</span> <span class="p">=</span> <span class="p">[]</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Flag</span><span class="p">{</span>
		<span class="nx">cli</span><span class="p">.</span><span class="nx">BoolFlag</span><span class="p">{</span>
			<span class="nx">Name</span><span class="p">:</span>  <span class="s">&#34;c&#34;</span><span class="p">,</span>
			<span class="nx">Usage</span><span class="p">:</span> <span class="s">&#34;The number of bytes in each input file is written to the standard output&#34;</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="nx">cli</span><span class="p">.</span><span class="nx">BoolFlag</span><span class="p">{</span>
			<span class="nx">Name</span><span class="p">:</span>  <span class="s">&#34;l&#34;</span><span class="p">,</span>
			<span class="nx">Usage</span><span class="p">:</span> <span class="s">&#34;The number of lines in each input file is written to the standard output&#34;</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="nx">cli</span><span class="p">.</span><span class="nx">BoolFlag</span><span class="p">{</span>
			<span class="nx">Name</span><span class="p">:</span>  <span class="s">&#34;m&#34;</span><span class="p">,</span>
			<span class="nx">Usage</span><span class="p">:</span> <span class="s">&#34;The number of characters in each input file is written to the standard output&#34;</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="nx">cli</span><span class="p">.</span><span class="nx">BoolFlag</span><span class="p">{</span>
			<span class="nx">Name</span><span class="p">:</span>  <span class="s">&#34;w&#34;</span><span class="p">,</span>
			<span class="nx">Usage</span><span class="p">:</span> <span class="s">&#34;The number of words in each input file is written to the standard output&#34;</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">}</span>

<span class="c1">// We define what actually happens when running
</span><span class="c1"></span>
	<span class="nx">app</span><span class="p">.</span><span class="nx">Action</span> <span class="p">=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>

		<span class="kd">var</span> <span class="nx">buf</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">Buffer</span>
		<span class="kd">var</span> <span class="nx">m</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span>
		<span class="nx">m</span> <span class="p">=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">)</span>

<span class="cm">/* 
</span><span class="cm">We check for text passed to Stdin, just so we 
</span><span class="cm">can invoke the app by doing `
</span><span class="cm">echo &#34;hello&#34; | wc -m
</span><span class="cm">` 
</span><span class="cm">*/</span>

		<span class="nx">scanner</span> <span class="o">:=</span> <span class="nx">bufio</span><span class="p">.</span><span class="nf">NewScanner</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stdin</span><span class="p">)</span>
		<span class="k">for</span> <span class="nx">scanner</span><span class="p">.</span><span class="nf">Scan</span><span class="p">()</span> <span class="p">{</span>
			<span class="nx">buf</span><span class="p">.</span><span class="nf">WriteString</span><span class="p">(</span><span class="nx">scanner</span><span class="p">.</span><span class="nf">Text</span><span class="p">())</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">scanner</span><span class="p">.</span><span class="nf">Err</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
			<span class="nx">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
		<span class="p">}</span>

<span class="cm">/* 
</span><span class="cm">Maybe some filenames have been passed as argument. 
</span><span class="cm">We have to retrieve the text from those and 
</span><span class="cm">store it in a buffer 
</span><span class="cm">*/</span>

		<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Args</span><span class="p">()</span> <span class="p">{</span>
			<span class="nx">fmt</span><span class="p">.</span><span class="nf">Print</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
			<span class="nx">content</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nf">ReadFile</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nf">Args</span><span class="p">().</span><span class="nf">Get</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span>
			<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
				<span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
			<span class="p">}</span>
			<span class="nx">buf</span><span class="p">.</span><span class="nf">WriteString</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">content</span><span class="p">))</span>
		<span class="p">}</span>

<span class="c1">// Now, depending on passed flags, we run the counting
</span><span class="c1"></span>
		<span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Bool</span><span class="p">(</span><span class="s">&#34;c&#34;</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">m</span><span class="p">[</span><span class="s">&#34;clen&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="nf">byteCounts</span><span class="p">(</span><span class="nx">buf</span><span class="p">.</span><span class="nf">String</span><span class="p">())</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Bool</span><span class="p">(</span><span class="s">&#34;l&#34;</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">m</span><span class="p">[</span><span class="s">&#34;llen&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="nf">lineCounts</span><span class="p">(</span><span class="nx">buf</span><span class="p">.</span><span class="nf">String</span><span class="p">())</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Bool</span><span class="p">(</span><span class="s">&#34;m&#34;</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">m</span><span class="p">[</span><span class="s">&#34;mlen&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="nf">characterCounts</span><span class="p">(</span><span class="nx">buf</span><span class="p">.</span><span class="nf">String</span><span class="p">())</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Bool</span><span class="p">(</span><span class="s">&#34;w&#34;</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">m</span><span class="p">[</span><span class="s">&#34;wlen&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="nf">wordCounts</span><span class="p">(</span><span class="nx">buf</span><span class="p">.</span><span class="nf">String</span><span class="p">())</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Bool</span><span class="p">(</span><span class="s">&#34;c&#34;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Bool</span><span class="p">(</span><span class="s">&#34;m&#34;</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">m</span><span class="p">[</span><span class="s">&#34;mlen&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="mi">0</span>
		<span class="p">}</span>

<span class="c1">// Printing the final values
</span><span class="c1"></span>
		<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">value</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">m</span> <span class="p">{</span>
			<span class="k">if</span> <span class="nx">value</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">{</span>
				<span class="nx">fmt</span><span class="p">.</span><span class="nf">Print</span><span class="p">(</span><span class="s">&#34;\t&#34;</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">)</span>

		<span class="k">return</span> <span class="kc">nil</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">app</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">app</span> <span class="o">:=</span> <span class="nf">wc</span><span class="p">()</span>
	<span class="nx">app</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">)</span>
<span class="p">}</span>

</code></pre></div><p>Is not perfect, and the functionality is not 100% on par with the real tool, but I learned a couple of things while doing this. That was the goal!</p>
<p>Just for fun, here is the goroutines/channels enabled version. Pick your choice!</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;bufio&#34;</span>
	<span class="s">&#34;bytes&#34;</span>
	<span class="s">&#34;fmt&#34;</span>
	<span class="s">&#34;io/ioutil&#34;</span>
	<span class="s">&#34;log&#34;</span>
	<span class="s">&#34;os&#34;</span>
	<span class="s">&#34;strings&#34;</span>
	<span class="s">&#34;sync&#34;</span>
	<span class="s">&#34;unicode/utf8&#34;</span>

	<span class="s">&#34;github.com/urfave/cli&#34;</span>
<span class="p">)</span>

<span class="kd">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>

<span class="kd">func</span> <span class="nf">byteCounts</span><span class="p">(</span><span class="nx">text</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">lineCounts</span><span class="p">(</span><span class="nx">text</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="s">&#34;\n&#34;</span><span class="p">))</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">characterCounts</span><span class="p">(</span><span class="nx">text</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">utf8</span><span class="p">.</span><span class="nf">RuneCountInString</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">wordCounts</span><span class="p">(</span><span class="nx">text</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nf">Fields</span><span class="p">(</span><span class="nx">text</span><span class="p">))</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">wc</span><span class="p">()</span> <span class="o">*</span><span class="nx">cli</span><span class="p">.</span><span class="nx">App</span> <span class="p">{</span>
	<span class="nx">app</span> <span class="o">:=</span> <span class="nx">cli</span><span class="p">.</span><span class="nf">NewApp</span><span class="p">()</span>
	<span class="nx">app</span><span class="p">.</span><span class="nx">Name</span> <span class="p">=</span> <span class="s">&#34;WC&#34;</span>
	<span class="nx">app</span><span class="p">.</span><span class="nx">Usage</span> <span class="p">=</span> <span class="s">&#34;The wc utility displays the number of lines, words, and bytes contained in each input file&#34;</span>
	<span class="nx">app</span><span class="p">.</span><span class="nx">Flags</span> <span class="p">=</span> <span class="p">[]</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Flag</span><span class="p">{</span>
		<span class="nx">cli</span><span class="p">.</span><span class="nx">BoolFlag</span><span class="p">{</span>
			<span class="nx">Name</span><span class="p">:</span>  <span class="s">&#34;c&#34;</span><span class="p">,</span>
			<span class="nx">Usage</span><span class="p">:</span> <span class="s">&#34;The number of bytes in each input file is written to the standard output&#34;</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="nx">cli</span><span class="p">.</span><span class="nx">BoolFlag</span><span class="p">{</span>
			<span class="nx">Name</span><span class="p">:</span>  <span class="s">&#34;l&#34;</span><span class="p">,</span>
			<span class="nx">Usage</span><span class="p">:</span> <span class="s">&#34;The number of lines in each input file is written to the standard output&#34;</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="nx">cli</span><span class="p">.</span><span class="nx">BoolFlag</span><span class="p">{</span>
			<span class="nx">Name</span><span class="p">:</span>  <span class="s">&#34;m&#34;</span><span class="p">,</span>
			<span class="nx">Usage</span><span class="p">:</span> <span class="s">&#34;The number of characters in each input file is written to the standard output&#34;</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="nx">cli</span><span class="p">.</span><span class="nx">BoolFlag</span><span class="p">{</span>
			<span class="nx">Name</span><span class="p">:</span>  <span class="s">&#34;w&#34;</span><span class="p">,</span>
			<span class="nx">Usage</span><span class="p">:</span> <span class="s">&#34;The number of words in each input file is written to the standard output&#34;</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">}</span>
	<span class="nx">app</span><span class="p">.</span><span class="nx">Action</span> <span class="p">=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>

		<span class="kd">var</span> <span class="nx">buf</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">Buffer</span>
		<span class="kd">var</span> <span class="nx">m</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span>
		<span class="nx">m</span> <span class="p">=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">)</span>

		<span class="nx">scanner</span> <span class="o">:=</span> <span class="nx">bufio</span><span class="p">.</span><span class="nf">NewScanner</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stdin</span><span class="p">)</span>
		<span class="k">for</span> <span class="nx">scanner</span><span class="p">.</span><span class="nf">Scan</span><span class="p">()</span> <span class="p">{</span>
			<span class="nx">buf</span><span class="p">.</span><span class="nf">WriteString</span><span class="p">(</span><span class="nx">scanner</span><span class="p">.</span><span class="nf">Text</span><span class="p">())</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">scanner</span><span class="p">.</span><span class="nf">Err</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
			<span class="nx">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
		<span class="p">}</span>

		<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Args</span><span class="p">()</span> <span class="p">{</span>
			<span class="nx">fmt</span><span class="p">.</span><span class="nf">Print</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
			<span class="nx">content</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nf">ReadFile</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nf">Args</span><span class="p">().</span><span class="nf">Get</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span>
			<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
				<span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
			<span class="p">}</span>
			<span class="nx">buf</span><span class="p">.</span><span class="nf">WriteString</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">content</span><span class="p">))</span>
		<span class="p">}</span>

		<span class="nx">bytesChan</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">)</span>
		<span class="nx">linesChan</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">)</span>
		<span class="nx">charactersChan</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">)</span>
		<span class="nx">wordChan</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">)</span>

		<span class="nx">wg</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
		<span class="k">go</span> <span class="kd">func</span><span class="p">(</span><span class="nx">text</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">bytesChan</span> <span class="o">&lt;-</span> <span class="nf">byteCounts</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span>
			<span class="nx">wg</span><span class="p">.</span><span class="nf">Done</span><span class="p">()</span>
		<span class="p">}(</span><span class="nx">buf</span><span class="p">.</span><span class="nf">String</span><span class="p">())</span>
		<span class="k">go</span> <span class="kd">func</span><span class="p">(</span><span class="nx">text</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">linesChan</span> <span class="o">&lt;-</span> <span class="nf">lineCounts</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span>
			<span class="nx">wg</span><span class="p">.</span><span class="nf">Done</span><span class="p">()</span>
		<span class="p">}(</span><span class="nx">buf</span><span class="p">.</span><span class="nf">String</span><span class="p">())</span>
		<span class="k">go</span> <span class="kd">func</span><span class="p">(</span><span class="nx">text</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">charactersChan</span> <span class="o">&lt;-</span> <span class="nf">characterCounts</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span>
			<span class="nx">wg</span><span class="p">.</span><span class="nf">Done</span><span class="p">()</span>
		<span class="p">}(</span><span class="nx">buf</span><span class="p">.</span><span class="nf">String</span><span class="p">())</span>
		<span class="k">go</span> <span class="kd">func</span><span class="p">(</span><span class="nx">text</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">wordChan</span> <span class="o">&lt;-</span> <span class="nf">wordCounts</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span>
			<span class="nx">wg</span><span class="p">.</span><span class="nf">Done</span><span class="p">()</span>
		<span class="p">}(</span><span class="nx">buf</span><span class="p">.</span><span class="nf">String</span><span class="p">())</span>

		<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
			<span class="k">select</span> <span class="p">{</span>
			<span class="k">case</span> <span class="nx">msg1</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">bytesChan</span><span class="p">:</span>
				<span class="nx">m</span><span class="p">[</span><span class="s">&#34;c&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="nx">msg1</span>
				<span class="nx">m</span><span class="p">[</span><span class="s">&#34;m&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="mi">0</span>
			<span class="k">case</span> <span class="nx">msg2</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">linesChan</span><span class="p">:</span>
				<span class="nx">m</span><span class="p">[</span><span class="s">&#34;l&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="nx">msg2</span>
			<span class="k">case</span> <span class="nx">msg3</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">charactersChan</span><span class="p">:</span>
				<span class="nx">m</span><span class="p">[</span><span class="s">&#34;m&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="nx">msg3</span>
				<span class="nx">m</span><span class="p">[</span><span class="s">&#34;c&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="mi">0</span>
			<span class="k">case</span> <span class="nx">msg4</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">wordChan</span><span class="p">:</span>
				<span class="nx">m</span><span class="p">[</span><span class="s">&#34;w&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="nx">msg4</span>
			<span class="p">}</span>
		<span class="p">}</span>

		<span class="nx">wg</span><span class="p">.</span><span class="nf">Wait</span><span class="p">()</span>
		<span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">m</span> <span class="p">{</span>
			<span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Bool</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">value</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">{</span>
				<span class="nx">fmt</span><span class="p">.</span><span class="nf">Print</span><span class="p">(</span><span class="s">&#34;\t&#34;</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="s">&#34;: &#34;</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">)</span>

		<span class="k">return</span> <span class="kc">nil</span>
	<span class="p">}</span>
		
	<span class="k">return</span> <span class="nx">app</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">app</span> <span class="o">:=</span> <span class="nf">wc</span><span class="p">()</span>
	<span class="nx">app</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">)</span>
<span class="p">}</span>

</code></pre></div><h2 id="running-the-final-version">Running the final version</h2>
<p>We can build the executable:</p>
<pre><code>go build -o gwc wc/wc.go
</code></pre>
<p>Where
<code>gwc</code>
is my desired executable filename (to don&rsquo;t mix it up with the real
<code>wc</code>
) and
<code>wc/wc.go</code>
is the path where I keep the script. On mac and linux you will get the
<code>gwc</code>
file you need to call with
<code>./gwc</code>
unless you add it to your path. On Windows you should get
<code>gwc.exe</code>
.</p>
<p>And we can run it:</p>
<pre><code>echo &quot;hello dev.to&quot; | ./gwc -c 
</code></pre>
<p>outputs
<code>12</code></p>
<p>If you are on Windows, I am not sure how passing stdin text works in the command line, so you could try this alternate example:</p>
<p>Create a file with some text, and do:</p>
<pre><code>gwc.exe -c myfile.txt
</code></pre>
<p>So now, time to implement the other 97 remaining coreutils!</p>
<p><em><a href="https://dev.to/rubenwap/upskill-yourself-by-recreating-gnu-coretools-in-go-9f5">This post is also available on DEV.</a></em></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->


        
          <div class="blog-tags">
            
              <a href="//tags/go/">go</a>&nbsp;
            
              <a href="//tags/tutorial/">tutorial</a>&nbsp;
            
          </div>
        

        

        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="/blog/i-was-doing-bad-stuff-in-my-first-dev-job-sorry-part-ii-iak/" data-toggle="tooltip" data-placement="top" title="I was doing bad stuff in my first dev job. Sorry! (Part II)">&larr; Previous Post</a>
            </li>
          
          
            <li class="next">
              <a href="/blog/will-this-quick-julia-lesson-make-you-forget-about-python-for-your-data-needs-4d1c/" data-toggle="tooltip" data-placement="top" title="Will this quick Julia lesson make you forget about Python for your data needs? ">Next Post &rarr;</a>
            </li>
          
        </ul>
      


      

    </div>
  </div>
</div>

      
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
        </ul>
        <p class="credits copyright text-muted">
          

          &nbsp;&bull;&nbsp;&copy;
          
            2021
          

          
            &nbsp;&bull;&nbsp;
            <a href="/">rubensanchez.dev</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="https://gohugo.io">Hugo v0.76.5</a> powered &nbsp;&bull;&nbsp; Theme <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> adapted from <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="/js/main.js"></script><script> renderMathInElement(document.body); </script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="/js/load-photoswipe.js"></script>









    
  </body>
</html>

